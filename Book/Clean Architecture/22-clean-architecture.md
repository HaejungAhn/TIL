## 22장. 클린 아키텍처

- 시스템 아키텍처와 관련한 여러가지 아이디어가 있는데 세부적인 면에서는 다소 차이가 있지만 목표가 모두 같다. 그것은 바로 "**관심사의 분리**"이다. 소프트웨어를 계층으로 분리함으로써 이 목표를 달성한다.

- 이들 아키텍처로 만든 시스템들이 가지는 특징들은 아래와 같다.
    
    - **프레임워크 독립성**   
    다양한 기능을 제공하는 프레임워크의 존재여부에 의존하지 않는다. (특정 프레임워크가 반드시 있어야만 시스템을 구현할 수 있는게 아님.)
    - **테스트 용이성**   
    업무 규칙(핵심 업무규칙을 말하는 것 같다. 자동화 시스템이 존재하지 않아도 존재해야 하는 규칙)은 DB, 웹서버, 또는 여타 외부 요소가 없어도 테스트할 수 있다.   
    -> 이걸 볼 때마다 Unit test를 꼭 공부해야겠다는 생각이 든다. 한번도 해보지 않아서 그런지 머릿속으로 그림이 잘 그려지지 않는다.
    - **UI, DB, 모든 외부 에이전시에 대한 독립성**   

- 클린 아키텍처 다이어그램  
<div style="text-align: center;"> 
    <img src="https://techblog.woowahan.com/wp-content/uploads/img/2019-10-02/the-clean-architecture.png" width="80%">
</div>   
    
- 안으로 들어갈수록 고수준 소프트웨어다.   
- 여기서 "수준"은 [19장 정책과 수준](./19-policy-and-level.md)에서도 언급됐듯이 입력 혹은 출력으로부터의 거리를 의미한다. 잘 변경되지 않아야 하는 것들(핵심 업무 규칙과 같은 것)이 입력/출력으로부터 멀리 떨어져있어야 하고 따라서 고수준 소프트웨어가 된다.
- 이런 아키텍처가 동작하도록 하는 가장 중요한 규칙은 "**의존성 규칙**"이다.
    >소스코드 의존성은 반드시 안쪽으로, 고수준의 정책을 향해야 한다.
- 외부 원에 위치한 그 어떤 것도 내부의 원에 영향을 주지 않도록 하는 것이 이상적이다. 따라서 DS(Data Structure)도 외부에서 사용하는 것과 내부에서 사용하는 것을 나누어야 한다.

- 위 다이어그램에 있는 각 원에 대한 설명
    - 엔티티는 핵심 업무 규칙을 캡슐화한다.
    - 유스케이스는 엔티티로 들어오고 나가는 데이터의 흐름을 조정한다. 
    - 인터페이스 어댑터는 엔티티/유즈케이스에서 사용하기 편리한 데이터 형식을 DB나 웹 같은 외부 에이전신에서 사용하기 편리한 데이터 형식으로 변환한다. converter의 역할을 한다. Controller, presenter, view 등이 이에 해당한다.   
    - 책에 아래와 같은 내용이 나와있는데 이를 토대로 봤을 때 의존성 방향은 저수준에서 고수준으로 가는게 기본이지만, 경우에 따라 고수준에서 저수준으로 향할 수도 있다. 고수준에서 저수준으로 향하는 것을 막기 위해 사용하는 것이 의존성 역전!   
        >*"모델은 그저 데이터 구조 정도에 지나지 않으며, 컨트롤러에서 유스케이스로 전달되고, 다시 유스케이스에서 프레젠터와 뷰로 되돌아간다."*
        
        이 내용을 보고 나니 18장에서 18.1, 18.2 다이어그램이 조금 이해가 갔다.
    
- 원은 반드시 4개일 필요가 없으나 의존성 규칙은 반드시 적용되어야 한다.(저수준에서 고수준 방향으로.)
